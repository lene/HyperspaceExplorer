<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>HyperspaceExplorer: Loki::SmallObjectBase&lt; ThreadingModel, chunkSize, maxSmallObjectSize, objectAlignSize, LifetimePolicy, MutexPolicy &gt; Class Template Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="classes.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="classes.html"><span>Alphabetical&nbsp;List</span></a></li>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="namespaceLoki.html">Loki</a>::<a class="el" href="classLoki_1_1SmallObjectBase.html">SmallObjectBase</a>
  </div>
</div>
<div class="contents">
<h1>Loki::SmallObjectBase&lt; ThreadingModel, chunkSize, maxSmallObjectSize, objectAlignSize, LifetimePolicy, MutexPolicy &gt; Class Template Reference<br>
<small>
[<a class="el" href="group__SmallObjectGroup.html">Small objects</a>]</small>
</h1><!-- doxytag: class="Loki::SmallObjectBase" --><code>#include &lt;<a class="el" href="SmallObj_8h-source.html">SmallObj.h</a>&gt;</code>
<p>
<div class="dynheader">
Inheritance diagram for Loki::SmallObjectBase&lt; ThreadingModel, chunkSize, maxSmallObjectSize, objectAlignSize, LifetimePolicy, MutexPolicy &gt;:</div>
<div class="dynsection">
<p><center><img src="classLoki_1_1SmallObjectBase__inherit__graph.png" border="0" usemap="#Loki_1_1SmallObjectBase_3_01ThreadingModel_00_01chunkSize_00_01maxSmallObjectSize_00_01objectAli39ca653c956b12443f5aa3129c148648" alt="Inheritance graph"></center>
<map name="Loki_1_1SmallObjectBase_3_01ThreadingModel_00_01chunkSize_00_01maxSmallObjectSize_00_01objectAli39ca653c956b12443f5aa3129c148648">
<area shape="rect" href="classLoki_1_1SmallObject.html" title="{Loki::SmallObject\&lt; ThreadingModel, chunkSize, maxSmallObjectSize, objectAlignSize, LifetimePolicy, MutexPolicy \&gt;\n||+ ~SmallObject()\l# SmallObject()\l&#45; SmallObject()\l&#45; operator=()\l}" alt="" coords="5,278,672,406"><area shape="rect" href="classLoki_1_1SmallValueObject.html" title="{Loki::SmallValueObject\&lt; ThreadingModel, chunkSize, maxSmallObjectSize, objectAlignSize, LifetimePolicy, MutexPolicy \&gt;\n||# SmallValueObject()\l# SmallValueObject()\l# operator=()\l# ~SmallValueObject()\l}" alt="" coords="696,278,1395,406"></map>
<center><font size="2">[<a href="graph_legend.html">legend</a>]</font></center></div>

<p>
<a href="classLoki_1_1SmallObjectBase-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Types</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="d07df1c9ec9c41580e07e32eddcda82d"></a><!-- doxytag: member="Loki::SmallObjectBase::ObjAllocatorSingleton" ref="d07df1c9ec9c41580e07e32eddcda82d" args="" -->
typedef <a class="el" href="classLoki_1_1AllocatorSingleton.html">AllocatorSingleton</a><br>
&lt; ThreadingModel, chunkSize, <br>
maxSmallObjectSize, <br>
objectAlignSize, <br>
LifetimePolicy &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLoki_1_1SmallObjectBase.html#d07df1c9ec9c41580e07e32eddcda82d">ObjAllocatorSingleton</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Defines type of allocator singleton, must be public to handle singleton lifetime dependencies. <br></td></tr>
<tr><td colspan="2"><br><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="39f9c8d5b17c09bece34c8a400981970"></a><!-- doxytag: member="Loki::SmallObjectBase::operator new" ref="39f9c8d5b17c09bece34c8a400981970" args="(std::size_t size)" -->
static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLoki_1_1SmallObjectBase.html#39f9c8d5b17c09bece34c8a400981970">operator new</a> (std::size_t size)  throw ( std::bad_alloc )</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Throwing single-object new throws bad_alloc when allocation fails. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="d212efa68b48292bf8fd2dd158b49400"></a><!-- doxytag: member="Loki::SmallObjectBase::operator new" ref="d212efa68b48292bf8fd2dd158b49400" args="(std::size_t size, const std::nothrow_t &amp;)" -->
static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLoki_1_1SmallObjectBase.html#d212efa68b48292bf8fd2dd158b49400">operator new</a> (std::size_t size, const std::nothrow_t &amp;)  throw ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Non-throwing single-object new returns NULL if allocation fails. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="dbbe1bde0960a38502af0940004d942f"></a><!-- doxytag: member="Loki::SmallObjectBase::operator new" ref="dbbe1bde0960a38502af0940004d942f" args="(std::size_t size, void *place)" -->
static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLoki_1_1SmallObjectBase.html#dbbe1bde0960a38502af0940004d942f">operator new</a> (std::size_t size, void *place)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Placement single-object new merely calls global placement new. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="698e8b9ebac9df8c03e557c842a59bc5"></a><!-- doxytag: member="Loki::SmallObjectBase::operator delete" ref="698e8b9ebac9df8c03e557c842a59bc5" args="(void *p, std::size_t size)" -->
static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLoki_1_1SmallObjectBase.html#698e8b9ebac9df8c03e557c842a59bc5">operator delete</a> (void *p, std::size_t size)  throw ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Single-object delete. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLoki_1_1SmallObjectBase.html#b835d84fa8bc1ed3a558dc2e7a7e39ec">operator delete</a> (void *p, const std::nothrow_t &amp;)  throw ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="e2da17da13c6c6a0d7e33c9df9eb27f2"></a><!-- doxytag: member="Loki::SmallObjectBase::operator delete" ref="e2da17da13c6c6a0d7e33c9df9eb27f2" args="(void *p, void *place)" -->
static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLoki_1_1SmallObjectBase.html#e2da17da13c6c6a0d7e33c9df9eb27f2">operator delete</a> (void *p, void *place)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Placement single-object delete merely calls global placement delete. <br></td></tr>
<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="d1c3a013df6cd2d95908003e006e1515"></a><!-- doxytag: member="Loki::SmallObjectBase::SmallObjectBase" ref="d1c3a013df6cd2d95908003e006e1515" args="(const SmallObjectBase &amp;)" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>SmallObjectBase</b> (const <a class="el" href="classLoki_1_1SmallObjectBase.html">SmallObjectBase</a> &amp;)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="6e872e4f97b5572c294dc0162cbcccf6"></a><!-- doxytag: member="Loki::SmallObjectBase::operator=" ref="6e872e4f97b5572c294dc0162cbcccf6" args="(const SmallObjectBase &amp;)" -->
<a class="el" href="classLoki_1_1SmallObjectBase.html">SmallObjectBase</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><b>operator=</b> (const <a class="el" href="classLoki_1_1SmallObjectBase.html">SmallObjectBase</a> &amp;)</td></tr>

<tr><td colspan="2"><br><h2>Private Types</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="90ac89e260a3b8f0427e8535289925dc"></a><!-- doxytag: member="Loki::SmallObjectBase::MyThreadingModel" ref="90ac89e260a3b8f0427e8535289925dc" args="" -->
typedef ThreadingModel<br>
&lt; <a class="el" href="classLoki_1_1AllocatorSingleton.html">ObjAllocatorSingleton</a>, <br>
MutexPolicy &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLoki_1_1SmallObjectBase.html#90ac89e260a3b8f0427e8535289925dc">MyThreadingModel</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Defines type for thread-safety locking mechanism. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="68898e5adb4be4d8b2527519b220e656"></a><!-- doxytag: member="Loki::SmallObjectBase::MyAllocatorSingleton" ref="68898e5adb4be4d8b2527519b220e656" args="" -->
typedef <br>
<a class="el" href="classLoki_1_1SingletonHolder.html">ObjAllocatorSingleton::MyAllocatorSingleton</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLoki_1_1SmallObjectBase.html#68898e5adb4be4d8b2527519b220e656">MyAllocatorSingleton</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Use singleton defined in <a class="el" href="classLoki_1_1AllocatorSingleton.html">AllocatorSingleton</a>. <br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
<h3>template&lt;template&lt; class, class &gt; class ThreadingModel, std::size_t chunkSize, std::size_t maxSmallObjectSize, std::size_t objectAlignSize, template&lt; class &gt; class LifetimePolicy, class MutexPolicy&gt;<br>
 class Loki::SmallObjectBase&lt; ThreadingModel, chunkSize, maxSmallObjectSize, objectAlignSize, LifetimePolicy, MutexPolicy &gt;</h3>

Base class for small object allocation classes. The shared implementation of the new and delete operators are here instead of being duplicated in both <a class="el" href="classLoki_1_1SmallObject.html">SmallObject</a> or <a class="el" href="classLoki_1_1SmallValueObject.html">SmallValueObject</a>, later just called Small-Objects. This class is not meant to be used directly by clients, or derived from by clients. Class has no data members so compilers can use Empty-Base-Optimization.<p>
<dl class="user" compact><dt><b>ThreadingModel</b></dt><dd>This class doesn't support ObjectLevelLockable policy for ThreadingModel. The allocator is a singleton, so a per-instance mutex is not necessary. Nor is using ObjectLevelLockable recommended with <a class="el" href="classLoki_1_1SingletonHolder.html" title="Provides Singleton amenities for a type T To protect that type from spurious instantiations...">SingletonHolder</a> since the SingletonHolder::MakeInstance function requires a mutex that exists prior to when the object is created - which is not possible if the mutex is inside the object, such as required for ObjectLevelLockable. If you attempt to use ObjectLevelLockable, the compiler will emit errors because it can't use the default constructor in ObjectLevelLockable. If you need a thread-safe allocator, use the ClassLevelLockable policy.</dd></dl>
<dl class="user" compact><dt><b>Lifetime Policy</b></dt><dd></dd></dl>
The <a class="el" href="classLoki_1_1SmallObjectBase.html">SmallObjectBase</a> template needs a lifetime policy because it owns a singleton of <a class="el" href="classLoki_1_1SmallObjAllocator.html">SmallObjAllocator</a> which does all the low level functions. When using a Small-Object in combination with the <a class="el" href="classLoki_1_1SingletonHolder.html" title="Provides Singleton amenities for a type T To protect that type from spurious instantiations...">SingletonHolder</a> template you have to choose two lifetimes, that of the Small-Object and that of the singleton. The rule is: The Small-Object lifetime must be greater than the lifetime of the singleton hosting the Small-Object. Violating this rule results in a crash on exit, because the hosting singleton tries to delete the Small-Object which is then already destroyed.<p>
The lifetime policies recommended for use with Small-Objects hosted by a <a class="el" href="classLoki_1_1SingletonHolder.html" title="Provides Singleton amenities for a type T To protect that type from spurious instantiations...">SingletonHolder</a> template are<ul>
<li><a class="el" href="structLoki_1_1LongevityLifetime_1_1DieAsSmallObjectParent.html">LongevityLifetime::DieAsSmallObjectParent</a> / <a class="el" href="structLoki_1_1LongevityLifetime_1_1DieAsSmallObjectChild.html">LongevityLifetime::DieAsSmallObjectChild</a></li><li><a class="el" href="classLoki_1_1SingletonWithLongevity.html" title="Implementation of the LifetimePolicy used by SingletonHolder Schedules an object&#39;s...">SingletonWithLongevity</a></li><li><a class="el" href="classLoki_1_1FollowIntoDeath.html" title="Lifetime policyfor the SingletonHolder tempalte. Followers will die after the master...">FollowIntoDeath</a> (not supported by MSVC 7.1)</li><li><a class="el" href="structLoki_1_1NoDestroy.html" title="Implementation of the LifetimePolicy used by SingletonHolder Never destroys the object...">NoDestroy</a></li></ul>
<p>
The default lifetime of Small-Objects is <a class="el" href="structLoki_1_1LongevityLifetime_1_1DieAsSmallObjectParent.html">LongevityLifetime::DieAsSmallObjectParent</a> to insure that memory is not released before a object with the lifetime <a class="el" href="structLoki_1_1LongevityLifetime_1_1DieAsSmallObjectChild.html">LongevityLifetime::DieAsSmallObjectChild</a> using that memory is destroyed. The <a class="el" href="structLoki_1_1LongevityLifetime_1_1DieAsSmallObjectParent.html">LongevityLifetime::DieAsSmallObjectParent</a> lifetime has the highest possible value of a SetLongevity lifetime, so you can use it in combination with your own lifetime not having also the highest possible value.<p>
The <a class="el" href="structLoki_1_1DefaultLifetime.html" title="Implementation of the LifetimePolicy used by SingletonHolder Schedules an object&#39;s...">DefaultLifetime</a> and <a class="el" href="classLoki_1_1PhoenixSingleton.html" title="Implementation of the LifetimePolicy used by SingletonHolder Schedules an object&#39;s...">PhoenixSingleton</a> policies are *not* recommended since they can cause the allocator to be destroyed and release memory for singletons hosting a object which inherit from either <a class="el" href="classLoki_1_1SmallObject.html">SmallObject</a> or <a class="el" href="classLoki_1_1SmallValueObject.html">SmallValueObject</a>.<p>
<dl class="user" compact><dt><b>Lifetime usage</b></dt><dd></dd></dl>
<ul>
<li><a class="el" href="namespaceLongevityLifetime.html" title="In this namespace are special lifetime policies to manage lifetime dependencies....">LongevityLifetime</a>: The Small-Object has <a class="el" href="structLoki_1_1LongevityLifetime_1_1DieAsSmallObjectParent.html">LongevityLifetime::DieAsSmallObjectParent</a> policy and the <a class="el" href="classLoki_1_1Singleton.html" title="Convenience template to implement a getter function for a singleton object. Often...">Singleton</a> hosting the Small-Object has <a class="el" href="structLoki_1_1LongevityLifetime_1_1DieAsSmallObjectChild.html">LongevityLifetime::DieAsSmallObjectChild</a>. The child lifetime has a hard coded SetLongevity lifetime which is shorter than the lifetime of the parent, thus the child dies before the parent.</li></ul>
<p>
<ul>
<li>Both Small-Object and <a class="el" href="classLoki_1_1Singleton.html" title="Convenience template to implement a getter function for a singleton object. Often...">Singleton</a> use <a class="el" href="classLoki_1_1SingletonWithLongevity.html" title="Implementation of the LifetimePolicy used by SingletonHolder Schedules an object&#39;s...">SingletonWithLongevity</a> policy. The longevity level for the singleton must be lower than that for the Small-Object. This is why the AllocatorSingleton's GetLongevity function returns the highest value.</li></ul>
<p>
<ul>
<li><a class="el" href="classLoki_1_1FollowIntoDeath.html" title="Lifetime policyfor the SingletonHolder tempalte. Followers will die after the master...">FollowIntoDeath</a> lifetime: The Small-Object has FollowIntoDeath::With&lt;LIFETIME&gt;::AsMasterLiftime policy and the <a class="el" href="classLoki_1_1Singleton.html" title="Convenience template to implement a getter function for a singleton object. Often...">Singleton</a> has FollowIntoDeath::AfterMaster&lt;MASTERSINGLETON&gt;::IsDestroyed policy, where you could choose the LIFETIME.</li></ul>
<p>
<ul>
<li>Both Small-Object and <a class="el" href="classLoki_1_1Singleton.html" title="Convenience template to implement a getter function for a singleton object. Often...">Singleton</a> use <a class="el" href="structLoki_1_1NoDestroy.html" title="Implementation of the LifetimePolicy used by SingletonHolder Never destroys the object...">NoDestroy</a> policy. Since neither is ever destroyed, the destruction order does not matter. Note: you will get memory leaks!</li></ul>
<p>
<ul>
<li>The Small-Object has <a class="el" href="structLoki_1_1NoDestroy.html" title="Implementation of the LifetimePolicy used by SingletonHolder Never destroys the object...">NoDestroy</a> policy but the <a class="el" href="classLoki_1_1Singleton.html" title="Convenience template to implement a getter function for a singleton object. Often...">Singleton</a> has <a class="el" href="classLoki_1_1SingletonWithLongevity.html" title="Implementation of the LifetimePolicy used by SingletonHolder Schedules an object&#39;s...">SingletonWithLongevity</a> policy. Note: you will get memory leaks!</li></ul>
<p>
You should *not* use <a class="el" href="structLoki_1_1NoDestroy.html" title="Implementation of the LifetimePolicy used by SingletonHolder Never destroys the object...">NoDestroy</a> for the singleton, and then use <a class="el" href="classLoki_1_1SingletonWithLongevity.html" title="Implementation of the LifetimePolicy used by SingletonHolder Schedules an object&#39;s...">SingletonWithLongevity</a> for the Small-Object.<p>
<dl class="user" compact><dt><b>Examples:</b></dt><dd></dd></dl>
<ul>
<li>test/SmallObj/SmallSingleton.cpp</li><li>test/Singleton/Dependencies.cpp </li></ul>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b835d84fa8bc1ed3a558dc2e7a7e39ec"></a><!-- doxytag: member="Loki::SmallObjectBase::operator delete" ref="b835d84fa8bc1ed3a558dc2e7a7e39ec" args="(void *p, const std::nothrow_t &amp;)" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; class, class &gt; class ThreadingModel, std::size_t chunkSize, std::size_t maxSmallObjectSize, std::size_t objectAlignSize, template&lt; class &gt; class LifetimePolicy, class MutexPolicy&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">static void <a class="el" href="classLoki_1_1SmallObjectBase.html">Loki::SmallObjectBase</a>&lt; ThreadingModel, chunkSize, maxSmallObjectSize, objectAlignSize, LifetimePolicy, MutexPolicy &gt;::operator delete           </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::nothrow_t &amp;&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%">  throw ()<code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Non-throwing single-object delete is only called when nothrow new operator is used, and the constructor throws an exception. 
<p>References <a class="el" href="Singleton_8h-source.html#l00787">Loki::SingletonHolder&lt; T, CreationPolicy, LifetimePolicy, ThreadingModel, MutexPolicy &gt;::Instance()</a>.</p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="classLoki_1_1SmallObjectBase_b835d84fa8bc1ed3a558dc2e7a7e39ec_cgraph.png" border="0" usemap="#classLoki_1_1SmallObjectBase_b835d84fa8bc1ed3a558dc2e7a7e39ec_cgraph_map" alt=""></center>
<map name="classLoki_1_1SmallObjectBase_b835d84fa8bc1ed3a558dc2e7a7e39ec_cgraph_map">
<area shape="rect" href="classLoki_1_1SingletonHolder.html#52a113a9dc9aa53a5ab777c573f9fa28" title="Returns a reference to singleton object." alt="" coords="289,5,481,32"></map>
</div>

</div>
</div><p>
<hr>The documentation for this class was generated from the following file:<ul>
<li>HyperspaceExplorer/src/Loki/<a class="el" href="SmallObj_8h-source.html">SmallObj.h</a></ul>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Jun 23 12:35:45 2008 for HyperspaceExplorer by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
